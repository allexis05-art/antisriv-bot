<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>–ê–Ω—Ç–∏—Å—Ä—ã–≤ ‚Äî Telegram Mini App</title>
  <meta name="theme-color" content="#16a34a" />
  <style>
    html,body{height:100%;margin:0}
    body{background:#fff;color:#1f2937;font-family:ui-sans-serif,system-ui,-apple-system,Roboto,Helvetica,Arial}
    body,button{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}

    /* ‚úÖ –°–±—Ä–æ—Å –Ω–∞—Ç–∏–≤–Ω–æ–π —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏ –∫–Ω–æ–ø–æ–∫ –≤ WebView (–æ—Å–æ–±–µ–Ω–Ω–æ iOS) */
    button{ -webkit-appearance:none; appearance:none; background:none; border:none; color:inherit; }
    button:focus-visible{ outline:2px solid #16a34a; outline-offset:2px; }

    a{ color:#16a34a; text-decoration:none; }
    a.underlined{ text-decoration:underline; }

    .page{padding-bottom:calc(16px + env(safe-area-inset-bottom));}
    .error-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);color:#fff;display:none;align-items:center;justify-content:center;text-align:left;padding:24px;z-index:9999}
    .error-overlay pre{white-space:pre-wrap;max-width:860px}

    /* iOS 100vh fix: –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º 100vh, –∞ –º–∏–Ω-–≤—ã—Å–æ—Ç—É –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ—Ç—Å—Ç—É–ø—ã */
    #root{min-height:100%;}
  </style>
  <!-- Telegram Web Apps SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <!-- React 18 UMD -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- Babel Standalone –¥–ª—è JSX -->
  <script>window.BABEL_DISABLE_CACHE = true;</script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
  <div id="root">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</div>
  <div id="err" class="error-overlay"><pre id="err-msg"></pre></div>

  <script type="text/babel" data-presets="env,react">
    'use strict';

    // ====== –û–≤–µ—Ä–ª–µ–π –æ—à–∏–±–æ–∫ ======
    (function(){
      const overlay = document.getElementById('err');
      const msg = document.getElementById('err-msg');
      window.__showFatal = (e)=>{ try{ msg.textContent = (e && (e.stack||e.message||String(e))) || 'Unknown error'; overlay.style.display='flex'; }catch(_){} };
      window.addEventListener('error', ev => { if(!/ResizeObserver/.test(String(ev?.message))) { __showFatal(ev.error || ev.message); } });
      window.addEventListener('unhandledrejection', ev => { __showFatal(ev.reason); });
    })();

    // ====== –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –±—Ä–µ–Ω–¥–∞ ======
    const BRAND_PRIMARY = '#16a34a'; // emerald-600
    const BRAND_PRIMARY_TEXT = '#ffffff';

    // ====== Analytics: Google Apps Script collector (—É—Å—Ç–æ–π—á–∏–≤—ã–π) ======
    const ANALYTICS_URL = 'PASTE_YOUR_GAS_EXEC_URL_HERE'; // –Ω–∞–ø—Ä–∏–º–µ—Ä: https://script.google.com/macros/s/XXX/exec?key=YYY
    const APP_VERSION = '1.0.0';
    const __QP = new URLSearchParams(location.search);
    const DEBUG = __QP.get('debug') === '1';
    const SESSION_ID = (crypto && crypto.randomUUID ? crypto.randomUUID() : (Date.now()+Math.random().toString(16).slice(2)));

    window.__analyticsState = { ok: null, lastError: null, lastResponse: null };

    async function sendAnalytics(payload){
      try {
        const body = new URLSearchParams({ payload: JSON.stringify(payload) });
        await fetch(ANALYTICS_URL, {
          method: 'POST',
          mode: 'no-cors',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8' },
          body
        });
        window.__analyticsState = { ok:true, lastError:null, lastResponse:null };
        if (DEBUG) console.log('[analytics] sent (form, opaque)', { payload });
        return { ok:true };
      } catch (e) {
        try {
          const blob = new Blob([new URLSearchParams({ payload: JSON.stringify(payload) })], { type: 'application/x-www-form-urlencoded;charset=utf-8' });
          const ok = navigator.sendBeacon ? navigator.sendBeacon(ANALYTICS_URL, blob) : false;
          window.__analyticsState = { ok, lastError: ok? null : 'sendBeacon failed', lastResponse:null };
          if (DEBUG) console.log('[analytics] sendBeacon(form)', ok);
          return { ok };
        } catch(_) {}
        window.__analyticsState = { ok:false, lastError:String(e), lastResponse:null };
        if (DEBUG) console.error('[analytics] failed', e);
        return { ok:false, error:e };
      }
    }

    async function logEvent(event, data = {}) {
      const tgUser = (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initDataUnsafe && window.Telegram.WebApp.initDataUnsafe.user) || null;
      const tgId   = tgUser ? tgUser.id : null;
      const tgName = tgUser ? [tgUser.first_name, tgUser.last_name].filter(Boolean).join(' ') : null;
      const qpId   = __QP.get('uid')   || '';
      const qpName = __QP.get('uname') || '';
      const userId   = (tgId != null ? String(tgId) : (data.user_id || qpId || ''));
      const userName = (tgName || data.user_name || qpName || '');
      const body = { event, ts_client: new Date().toISOString(), app_version: APP_VERSION, session_id: SESSION_ID, user_id: userId, user_name: userName, ...data };
      return sendAnalytics(body);
    }

    // ====== Helpers ======
    function get(o, path, d){ try{ let cur=o; for(let i=0;i<path.length;i++){ if(cur==null) return d; cur=cur[path[i]]; } return (cur===undefined?d:cur); }catch(e){ return d; } }
    function clamp(n,min,max){return Math.max(min,Math.min(max,n))}

    // ====== Telegram shim ======
    const TG_SHIM = { themeParams:{}, ready:()=>{}, close:()=>{}, openLink:(url)=>{ try{ window.open(url,'_blank','noopener'); }catch(e){ location.href=url; } }, sendData:()=>{}, MainButton:{ setParams:()=>{}, onClick:()=>{}, offClick:()=>{}, show:()=>{}, hide:()=>{} }, onEvent:()=>{}, offEvent:()=>{} };
    function useTelegram(){ const [tg,setTg] = React.useState(()=>get(window,["Telegram","WebApp"],null) || TG_SHIM); React.useEffect(()=>{ const t=get(window,["Telegram","WebApp"],null); if(t){ setTg(t); try{t.ready();}catch(_){} } },[]); return tg; }

    // ====== Theme (—Ñ–∏–∫—Å–∏—Ä—É–µ–º –∑–µ–ª—ë–Ω—ã–π primary) ======
    function useTheme(){
      const tg = useTelegram();
      const compute = React.useCallback(()=>{
        const p = tg && tg.themeParams || {};
        const isDark = (p.bg_color && parseInt(String(p.bg_color).replace('#',''),16) < 0x888888);
        return { isDark, bg: p.bg_color || (isDark?"#0b1220":"#f8fafc"), text: p.text_color || (isDark?"#e5e7eb":"#111827"), subtext: p.hint_color || (isDark?"#9ca3af":"#6b7280"), primary: BRAND_PRIMARY, primaryText: BRAND_PRIMARY_TEXT, border: p.section_separator_color || (isDark?"#1f2937":"#e5e7eb"), card: isDark?"#111827":"#fff" }
      },[tg]);
      const [theme,setTheme] = React.useState(()=>compute());
      React.useEffect(()=>{ if(!tg) return; const onTheme=()=>setTheme(compute()); try{ tg.onEvent && tg.onEvent('themeChanged', onTheme); }catch(_){ } return ()=>{ try{ tg.offEvent && tg.offEvent('themeChanged', onTheme); }catch(_){ } } },[tg,compute]);
      return theme;
    }

    // ====== UI helpers ======
    function btnPrimary(theme){ return {fontSize:16,padding:"12px 16px",border:"1px solid "+(theme?.primary||'#16a34a'),background:(theme?.primary||'#16a34a'),color:(theme?.primaryText||'#fff'),borderRadius:12,cursor:"pointer",fontWeight:700} }
    function btnOutline(theme){ return {fontSize:16,padding:"12px 16px",border:"1px solid "+(theme?.primary||'#16a34a'),background:(theme?.card||'#fff'),color:(theme?.text||'#111827'),borderRadius:12,cursor:"pointer",fontWeight:700} }
    function btnGhost(theme){ return {fontSize:14,padding:"10px 12px",border:"1px solid "+(theme?.border||'#e5e7eb'),background:(theme?.card||'#fff'),color:(theme?.text||'#111827'),borderRadius:10,cursor:"pointer"} }

    function Progress({value, theme}){ const v = clamp(Math.round(value),0,100); return (
      <div style={{height:8,background:"rgba(0,0,0,0.08)",borderRadius:8,overflow:"hidden"}}>
        <div style={{width:v+"%",height:"100%",background:theme.primary,transition:"width .25s ease"}} />
      </div>) }

    function Card({children,theme,mb=12}){ return <div style={{background:theme.card,border:"1px solid "+(theme?.border||'#e5e7eb'),borderRadius:12,overflow:"hidden",marginBottom:mb}}>{children}</div> }
    function CardHeader({title,subtitle,theme,tone='subtle'}){
      return (
        <div style={{padding:'12px 14px',background:tone==='brand'?'rgba(22,163,74,0.06)':'rgba(0,0,0,0.035)'}}>
          <div style={{fontWeight:800,fontSize: tone==='brand'?20:16,lineHeight:1.25}}>{title}</div>
          {subtitle && <div style={{marginTop:6,fontSize:12,color:theme.subtext}}>{subtitle}</div>}
        </div>
      );
    }
    function CardBody({children}){ return <div style={{padding:12}}>{children}</div> }

    function Pill({children,active,theme,onClick}){
      return <button onClick={onClick} style={{...btnGhost(theme),padding:'8px 10px',fontSize:13,borderColor: active? theme.primary : (theme?.border||'#e5e7eb'), background: active? 'rgba(22,163,74,.08)' : (theme?.card||'#fff')}}>{children}</button>
    }

    // ====== –ö–æ–Ω—Ç–µ–Ω—Ç: –°—Ç–æ–ø‚Äë–ø—Ä–æ—Ç–æ–∫–æ–ª (–∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞, —Ç–µ–∫—Å—Ç –Ω–µ–∏–∑–º–µ–Ω—ë–Ω) ======
    function StopProtocol({theme,onBack}){
      return (
        <Card theme={theme}>
          <CardHeader theme={theme} title="üõë –°—Ç–æ–ø‚Äë–ø—Ä–æ—Ç–æ–∫–æ–ª" tone='brand' />
          <CardBody>
            <div style={{lineHeight:1.5}}>
              <p>1) –û—Å—Ç–∞–Ω–æ–≤–∏—Å—å –∏ —Å–¥–µ–ª–∞–π 3 –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –≤–¥–æ—Ö–∞ –∏ –≤—ã–¥–æ—Ö–∞. –ü–æ–ª–æ–∂–∏ –ª–∞–¥–æ–Ω—å –Ω–∞ –∂–∏–≤–æ—Ç, –∑–∞–º–µ—á–∞–π, –∫–∞–∫ –æ–Ω –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –∏ –æ–ø—É—Å–∫–∞–µ—Ç—Å—è.</p>
              <p>2) –í—ã–ø–µ–π —Å—Ç–∞–∫–∞–Ω –≤–æ–¥—ã. –°–¥–µ–ª–∞–π –ø–∞—É–∑—É –Ω–∞ –ø–∞—Ä—É –º–∏–Ω—É—Ç.</p>
              <p>3) –ü—Ä–æ–≤–µ—Ä—å –≥–æ–ª–æ–¥ –ø–æ —à–∫–∞–ª–µ 0‚Äì5. –ï—Å–ª–∏ 3 –∏ –≤—ã—à–µ ‚Äî –ø–æ–µ—à—å; –µ—Å–ª–∏ –Ω–∏–∂–µ ‚Äî –≤—ã–±–µ—Ä–∏ –ø—Ä–∏—è—Ç–Ω–æ–µ –∑–∞–Ω—è—Ç–∏–µ –∏–∑ —Å–ø–∏—Å–∫–∞ —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–π –∏ –≤–µ—Ä–Ω–∏—Å—å –∫ —Å–≤–æ–∏–º –¥–µ–ª–∞–º.</p>
              <p>4) –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π —Å–µ–±—è –¥–æ–±—Ä—ã–º–∏ —Å–ª–æ–≤–∞–º–∏. –¢—ã —Å–ø—Ä–∞–≤–ª—è–µ—à—å—Å—è. –ú–∞–ª–µ–Ω—å–∫–∏–µ —à–∞–≥–∏ ‚Äî —Ç–æ–∂–µ –ø—É—Ç—å.</p>
            </div>
            <div style={{marginTop:12}}>
              <button style={btnPrimary(theme)} onClick={onBack}>‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —á–µ–∫‚Äë–∏–Ω—É</button>
            </div>
          </CardBody>
        </Card>
      );
    }

    // ====== –≠–∫—Ä–∞–Ω ¬´–ï—Å–ª–∏ —Å–ª—É—á–∏–ª—Å—è —Å—Ä—ã–≤¬ª (–ø–æ –≤–∞—à–µ–π —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–µ) ======
    function RelapseInfo({theme,onBack}){
      return (
        <Card theme={theme}>
          <CardHeader theme={theme} title="–ï—Å–ª–∏ —Å–ª—É—á–∏–ª—Å—è —Å—Ä—ã–≤" tone='brand' />
          <CardBody>
            <ol style={{lineHeight:1.55, paddingLeft:16}}>
              <li style={{marginBottom:8}}><b>–°–¥–µ–ª–∞–π –ø–∞—É–∑—É.</b> –°—Ä—ã–≤ ‚Äî –Ω–µ –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞, –∞ —Ä–µ–∞–∫—Ü–∏—è –º–æ–∑–≥–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è, —ç–º–æ—Ü–∏–∏, —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.</li>
              <li style={{marginBottom:8}}><b>–ó–∞–¥–∞–π —Å–µ–±–µ —Ç—Ä–∏ –≤–æ–ø—Ä–æ—Å–∞:</b><br/>‚Ä¢ –ù–∞ —á—Ç–æ —è —Å–µ–π—á–∞—Å —Å—Ä–µ–∞–≥–∏—Ä–æ–≤–∞–ª–∞ —Å—Ä—ã–≤–æ–º?<br/>‚Ä¢ –ß—Ç–æ –º–µ–Ω—è–µ—Ç—Å—è —Å–µ–π—á–∞—Å –≤ –º–æ–µ–π –∂–∏–∑–Ω–∏? –ö–∞–∫ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ?<br/>‚Ä¢ –ß–µ–≥–æ —è –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ —Ö–æ—Ç–µ–ª–∞ ‚Äî –æ—Ç–¥—ã—Ö–∞, —Ç–µ–ø–ª–∞, –ø–æ–¥–¥–µ—Ä–∂–∫–∏, —É–µ–¥–∏–Ω–µ–Ω–∏—è –∏–ª–∏ —á–µ–≥–æ-—Ç–æ –µ—â—ë?</li>
              <li style={{marginBottom:8}}><b>–û—Ç–º–µ—Ç—å –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç—å.</b> –í–∞–∂–Ω–æ –Ω–∞–π—Ç–∏ –∏—Å—Ç–∏–Ω–Ω—É—é –ø—Ä–∏—á–∏–Ω—É ‚Äî –æ–Ω–∞ —à–∏—Ä–µ ¬´—Å–∏–ª—ã –≤–æ–ª–∏¬ª. –ü–æ–¥—Ö–æ–¥ ¬´–Ω–∞ –∫–æ—Ä–æ—Ç–∫–æ–π –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏¬ª —á–∞—Å—Ç–æ –≤–µ–¥—ë—Ç –∫ —Å—Ä—ã–≤–∞–º. –ó–¥–æ—Ä–æ–≤–æ–µ –ø–∏—Ç–∞–Ω–∏–µ ‚Äî —ç—Ç–æ –Ω–æ–≤–∞—è –∫—É–ª—å—Ç—É—Ä–∞, –æ–Ω–∞ —Å–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –∏–∑ –∑–Ω–∞–Ω–∏–π, —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ –∏ –º–∞–ª–µ–Ω—å–∫–∏—Ö —Ä–∏—Ç—É–∞–ª–æ–≤.</li>
              <li style={{marginBottom:8}}><b>–ü–æ–¥–¥–µ—Ä–∂–∏ —Å–µ–±—è, –∞ –Ω–µ –∫—Ä–∏—Ç–∏–∫—É–π.</b> ¬´–°–µ–≥–æ–¥–Ω—è —è —Å–æ—Ä–≤–∞–ª–∞—Å—å, –Ω–æ —è –ø—Ä–æ–¥–æ–ª–∂–∞—é. –Ø —É–∂–µ –º–Ω–æ–≥–æ –¥–µ–ª–∞—é –ø—Ä–∞–≤–∏–ª—å–Ω–æ: –ø—å—é –±–æ–ª—å—à–µ –≤–æ–¥—ã, –∑–∞–≤—Ç—Ä–∞–∫–∞—é, –≤—Å—ë —á–∞—â–µ –≤—ã–±–∏—Ä–∞—é –ø–æ–ª–µ–∑–Ω–æ–µ, –µ–º –º–µ–Ω—å—à–µ —Å–ª–∞–¥–∫–æ–≥–æ‚Ä¶¬ª</li>
              <li><b>–°–¥–µ–ª–∞–π –≤—ã–≤–æ–¥—ã.</b> –û—Ç–º–µ—Ç—å –ø—Ä–∏—á–∏–Ω—É –≤ —á–µ–∫‚Äë–∏–Ω–µ, –∑–∞–ø–∏—à–∏ –∫–æ—Ä–æ—Ç–∫—É—é –∑–∞–º–µ—Ç–∫—É ‚Äî —Ç–∞–∫ —Ç—ã —É—á–∏—à—å—Å—è –ø–æ–Ω–∏–º–∞—Ç—å —Å–µ–±—è, –∞ –Ω–µ –±–æ—Ä–æ—Ç—å—Å—è —Å —Å–æ–±–æ–π üíö</li>
            </ol>
            <div style={{marginTop:12}}>
              <button style={btnPrimary(theme)} onClick={onBack}>‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —á–µ–∫‚Äë–∏–Ω—É</button>
            </div>
          </CardBody>
        </Card>
      );
    }

    // ====== –ü–æ–ª–µ–∑–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã (–≤—Å–µ–≥–¥–∞ –≤–∏–¥–Ω—ã) ======
    function Materials({theme,onOpenWater,onOpenFoods}){
      return (
        <Card theme={theme}>
          <CardHeader theme={theme} title="–ü–æ–ª–µ–∑–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã" tone='subtle' />
          <CardBody>
            <div style={{display:'grid',gap:8}}>
              <button style={btnOutline(theme)} onClick={onOpenWater}>üíß –ì–∞–π–¥ –ø–æ –≤–æ–¥–µ</button>
              <button style={btnOutline(theme)} onClick={onOpenFoods}>üß∫ –°–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤</button>
            </div>
          </CardBody>
        </Card>
      );
    }

    // ====== –ì–∞–π–¥ –ø–æ –≤–æ–¥–µ (–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è) ======
    function WaterGuide({theme,onBack}){
      return (
        <Card theme={theme}>
          <CardHeader theme={theme} title="üíß –ì–∞–π–¥ –ø–æ –≤–æ–¥–µ" tone='brand' />
          <CardBody>
            <div style={{lineHeight:1.55}}>
              <p>1Ô∏è‚É£ –°—Ç–∞—Ä–∞–π—Å—è –ø–∏—Ç—å 25‚Äì40 –º–ª –≤–æ–¥—ã –Ω–∞ –∫–≥ –≤–µ—Å–∞, –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–µ —á—É–≤—Å—Ç–≤—É–µ—à—å –∂–∞–∂–¥—ã.</p>
              <p>2Ô∏è‚É£ –°—á–∏—Ç–∞–π —É—Ä–æ–≤–µ–Ω—å –∂–∏–¥–∫–æ—Å—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ: <b>‚úÖ</b> –≤–æ–¥–∞, –Ω–µ—Å–ª–∞–¥–∫–∏–π —á–∞–π/–∫–æ—Ñ–µ, –º–æ—Ä—Å—ã, —Å—É–ø—ã ‚Äî –≤ –Ω–æ—Ä–º–µ; <b>‚ùå</b> —Å–ª–∞–¥–∫–∏–µ –Ω–∞–ø–∏—Ç–∫–∏ –∏ –∞–ª–∫–æ–≥–æ–ª—å ‚Äî –¥–µ–≥–∏–¥—Ä–∏—Ä—É—é—Ç.</p>
              <p>3Ô∏è‚É£ –ù–∞—á–∏–Ω–∞–π –¥–µ–Ω—å —Å–æ —Å—Ç–∞–∫–∞–Ω–∞-–¥–≤—É—Ö –≤–æ–¥—ã. –õ—É—á—à–µ —Ç—ë–ø–ª–æ–π; –ª–∏–º–æ–Ω ‚Äî –ø–æ –∂–µ–ª–∞–Ω–∏—é.</p>
              <p>4Ô∏è‚É£ –ü–µ–π —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ: 6‚Äì10 –ø—Ä–∏—ë–º–æ–≤ –≤ –¥–µ–Ω—å, –º–µ–Ω—å—à–µ –∑–∞ 2‚Äì3 —á–∞—Å–∞ –¥–æ —Å–Ω–∞; –Ω–µ –±–æ–ª–µ–µ 300 –º–ª –∑–∞ —Ä–∞–∑.</p>
              <p>5Ô∏è‚É£ –ü–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–π—Å—è –ø–æ–¥ —É—Å–ª–æ–≤–∏—è: –∂–∞—Ä–∞, —Å–ø–æ—Ä—Ç, —Å—É—Ö–æ–π –≤–æ–∑–¥—É—Ö ‚Äî –≤–æ–¥—ã –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ.</p>
              <p>6Ô∏è‚É£ –ï—Å–ª–∏ —Ä–∞–Ω—å—à–µ –ø–∏–ª–∞ –º–∞–ª–æ ‚Äî –¥–æ–±–∞–≤–ª—è–π 300‚Äì500 –º–ª –∫–∞–∂–¥—ã–µ 2‚Äì3 –¥–Ω—è (–¥–æ 4 –ª –º–∞–∫—Å–∏–º—É–º).</p>
              <p>7Ô∏è‚É£ –û—Ç—Å–ª–µ–∂–∏–≤–∞–π –º–∞—Ä–∫–µ—Ä—ã: —Å–≤–µ—Ç–ª–æ‚Äë—Å–æ–ª–æ–º–µ–Ω–Ω—ã–π —Ü–≤–µ—Ç –º–æ—á–∏, —Ä–µ–≥—É–ª—è—Ä–Ω—ã–π —Å—Ç—É–ª, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–∏–ª—å–Ω–æ–π –∂–∞–∂–¥—ã.</p>
              <p>9Ô∏è‚É£ –ó–∞–±–æ—Ç—å—Å—è –æ –ñ–ö–¢: –∫–ª–µ—Ç—á–∞—Ç–∫–∞ + –¥–≤–∏–∂–µ–Ω–∏–µ + –ø–æ–ª–µ–∑–Ω—ã–µ –∂–∏—Ä—ã.</p>
              <p>üîü –ü—Ä–∏ —Ö—Ä–æ–Ω–∏—á–µ—Å–∫–∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏—è—Ö ‚Äî –æ—Ä–∏–µ–Ω—Ç–∏—Ä—É–π—Å—è –Ω–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ª–µ—á–∞—â–µ–≥–æ –≤—Ä–∞—á–∞.</p>
              <div style={{marginTop:12}}>
                <button style={btnPrimary(theme)} onClick={onBack}>‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —á–µ–∫‚Äë–∏–Ω—É</button>
              </div>
            </div>
          </CardBody>
        </Card>
      );
    }

    // ====== –°–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ (—É–ø—Ä–æ—â—ë–Ω–Ω–æ ‚Äî –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∫–∞–∫ –≤ –∏—Å—Ö–æ–¥–Ω–∏–∫–µ) ======
    function FoodsList({theme,onBack}){
      const Block = ({title,items}) => (
        <div style={{marginBottom:12}}>
          <div style={{fontWeight:800}}>{title}</div>
          <div style={{marginTop:6,lineHeight:1.6}}>
            {items.map((t,i)=> <div key={i}>‚Ä¢ {t}</div>)}
          </div>
        </div>
      );
      return (
        <Card theme={theme}>
          <CardHeader theme={theme} title="üß∫ –°–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤" tone='brand' />
          <CardBody>
            <div>
              <div style={{marginBottom:12}}>
                <a class="underlined" href="#protein" onClick={(e)=>e.preventDefault()}>üçó –ë–ï–õ–û–ö</a> ¬∑
                <a class="underlined" href="#carbs" onClick={(e)=>e.preventDefault()} style={{marginLeft:8}}>üçö –£–ì–õ–ï–í–û–î–´</a> ¬∑
                <a class="underlined" href="#veggies" onClick={(e)=>e.preventDefault()} style={{marginLeft:8}}>ü•¶ –û–í–û–©–ò/–ó–ï–õ–ï–ù–¨/–§–†–£–ö–¢–´</a>
              </div>
              <Block title="üçó –ë–ï–õ–û–ö" items={["–ö—É—Ä–∏—Ü–∞, –∏–Ω–¥–µ–π–∫–∞, —Ä—ã–±–∞","–Ø–π—Ü–∞","–¢–≤–æ—Ä–æ–≥, –≥—Ä–µ—á–µ—Å–∫–∏–π –π–æ–≥—É—Ä—Ç","–ë–æ–±–æ–≤—ã–µ"]} />
              <Block title="üçö –£–ì–õ–ï–í–û–î–´" items={["–¶–µ–ª—å–Ω–æ–∑–µ—Ä–Ω–æ–≤–æ–π —Ö–ª–µ–±","–ì—Ä–µ—á–∫–∞, –∫–∏–Ω–æ–∞, –±—É–ª–≥—É—Ä","–û–≤—Å—è–Ω—ã–µ —Ö–ª–æ–ø—å—è","–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å"]} />
              <Block title="ü•¶ –û–í–û–©–ò / –ó–ï–õ–ï–ù–¨ / –§–†–£–ö–¢–´" items={["–°–∞–ª–∞—Ç—ã –ª–∏—Å—Ç–æ–≤—ã–µ","–û–≥—É—Ä—Ü—ã, –ø–æ–º–∏–¥–æ—Ä—ã","–ë—Ä–æ–∫–∫–æ–ª–∏, —Ü–≤–µ—Ç–Ω–∞—è –∫–∞–ø—É—Å—Ç–∞","–Ø–≥–æ–¥—ã, —è–±–ª–æ–∫–∏"]} />
            </div>
            <div style={{marginTop:12}}>
              <button style={btnPrimary(theme)} onClick={onBack}>‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —á–µ–∫‚Äë–∏–Ω—É</button>
            </div>
          </CardBody>
        </Card>
      );
    }

    // ====== –ß–µ–∫‚Äë–∏–Ω ======
    const HUNGER_REASONS = ["—Å–∫—É–∫–∞","—Å—Ç—Ä–µ—Å—Å","–æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–æ","–¥–∞–≤–Ω–æ –µ–ª–∞","—É—Å—Ç–∞–ª–æ—Å—Ç—å","–ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏—è","–¥—Ä—É–≥–æ–µ"];
    const BINGE_CONTEXT  = ["–µ–¥–∞ –≤ –∫–æ–º–ø–∞–Ω–∏–∏","–∞–ª–∫–æ–≥–æ–ª—å","–≤—ã—Ö–æ–¥–Ω—ã–µ","—É —Ä–æ–¥–∏—Ç–µ–ª–µ–π","–æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–æ"]; // –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–æ –æ—Å—Ç–∞–≤–ª–µ–Ω–æ –æ–¥–∏–Ω —Ä–∞–∑

    function Checkin({theme,onDone}){
      const [step,setStep] = React.useState(0); // 0 hunger, 1 reasons?, 2 mood, 3 binge, 4 binge context
      const [hunger,setHunger] = React.useState(0);
      const [reasons,setReasons] = React.useState([]);
      const [mood,setMood] = React.useState('–Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–µ');
      const [binge,setBinge] = React.useState('–Ω–µ—Ç');
      const [bingeCtx,setBingeCtx] = React.useState([]);

      React.useEffect(()=>{ logEvent('step_shown',{flow_step:['hunger','reasons','mood','binge','binge_context'][step]}); },[step]);

      function toggleReason(v){ setReasons(prev=> prev.includes(v)? prev.filter(x=>x!==v) : [...prev,v]); }
      function toggleCtx(v){ setBingeCtx(prev=> prev.includes(v)? prev.filter(x=>x!==v) : [...prev,v]); }

      const next = ()=> setStep(s=> Math.min(4, s+1));
      const prev = ()=> setStep(s=> Math.max(0, s-1));

      const showReasons = hunger>2;

      function finish(){ onDone({ hunger, reasons, mood, binge, binge_context: binge==='–¥–∞'? bingeCtx : [] }); }

      return (
        <Card theme={theme}>
          <CardHeader theme={theme} title="–ß–µ–∫‚Äë–∏–Ω" subtitle="1 –º–∏–Ω—É—Ç–∞, —á—Ç–æ–±—ã –æ—Ü–µ–Ω–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å —Å–µ–±—è" tone='brand' />
          <CardBody>
            <div style={{marginBottom:12}}><Progress theme={theme} value={(step+1)/(showReasons?5:4)*100} /></div>

            {step===0 && (
              <div>
                <div style={{fontWeight:600}}>–û—Ü–µ–Ω–∫–∞ –≥–æ–ª–æ–¥–∞</div>
                <div style={{fontSize:12,color:theme.subtext,marginTop:4}}>0 ‚Äî —Å—ã—Ç–æ ‚Ä¶ 5 ‚Äî —Å–∏–ª—å–Ω—ã–π –≥–æ–ª–æ–¥</div>
                <div style={{display:'flex',gap:8,flexWrap:'wrap',marginTop:8}}>
                  {[0,1,2,3,4,5].map(v=> (
                    <Pill key={v} theme={theme} active={hunger===v} onClick={()=>setHunger(v)}>{v}</Pill>
                  ))}
                </div>
                <div style={{display:'flex',gap:8,marginTop:12}}>
                  <button style={btnPrimary(theme)} onClick={()=> setStep(showReasons?1:2)}>–î–∞–ª—å—à–µ</button>
                </div>
              </div>
            )}

            {step===1 && showReasons && (
              <div>
                <div style={{fontWeight:600}}>–ü–æ—á–µ–º—É —Å–µ–π—á–∞—Å —Ç–∞–∫–∞—è –æ—Ü–µ–Ω–∫–∞?</div>
                <div style={{fontSize:12,color:theme.subtext,marginTop:4}}>–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤</div>
                <div style={{display:'flex',gap:8,flexWrap:'wrap',marginTop:8}}>
                  {HUNGER_REASONS.map(r=> (
                    <Pill key={r} theme={theme} active={reasons.includes(r)} onClick={()=>toggleReason(r)}>{r}</Pill>
                  ))}
                </div>
                <div style={{display:'flex',gap:8,marginTop:12}}>
                  <button style={btnGhost(theme)} onClick={prev}>–ù–∞–∑–∞–¥</button>
                  <button style={btnPrimary(theme)} onClick={next}>–î–∞–ª—å—à–µ</button>
                </div>
              </div>
            )}

            {((step===1 && !showReasons) || (step===2 && showReasons)) && (
              <div>
                <div style={{fontWeight:600}}>–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</div>
                <div style={{display:'flex',gap:8,flexWrap:'wrap',marginTop:8}}>
                  {["—Ö–æ—Ä–æ—à–µ–µ","–Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–µ","–ø–ª–æ—Ö–æ–µ"].map(m=> (
                    <Pill key={m} theme={theme} active={mood===m} onClick={()=>setMood(m)}>{m}</Pill>
                  ))}
                </div>
                <div style={{display:'flex',gap:8,marginTop:12}}>
                  <button style={btnGhost(theme)} onClick={prev}>–ù–∞–∑–∞–¥</button>
                  <button style={btnPrimary(theme)} onClick={next}>–î–∞–ª—å—à–µ</button>
                </div>
              </div>
            )}

            {((step===2 && !showReasons) || (step===3 && showReasons)) && (
              <div>
                <div style={{fontWeight:600}}>–ë—ã–ª –ª–∏ —Å—Ä—ã–≤ / –ø–µ—Ä–µ–µ–¥–∞–Ω–∏–µ?</div>
                <div style={{display:'flex',gap:8,flexWrap:'wrap',marginTop:8}}>
                  {["–Ω–µ—Ç","–¥–∞"].map(b=> (
                    <Pill key={b} theme={theme} active={binge===b} onClick={()=>setBinge(b)}>{b}</Pill>
                  ))}
                </div>
                <div style={{display:'flex',gap:8,marginTop:12}}>
                  <button style={btnGhost(theme)} onClick={prev}>–ù–∞–∑–∞–¥</button>
                  <button style={btnPrimary(theme)} onClick={()=> setStep(binge==='–¥–∞'?(showReasons?4:3):(showReasons?4:3))}>–î–∞–ª—å—à–µ</button>
                </div>
              </div>
            )}

            {((step===4 && showReasons) || (step===3 && !showReasons)) && binge==='–¥–∞' && (
              <div>
                <div style={{fontWeight:600}}>–ß—Ç–æ –ø–æ—Å–ª—É–∂–∏–ª–æ —Ç—Ä–∏–≥–≥–µ—Ä–æ–º? –ß—Ç–æ –ø—Ä–µ–¥—à–µ—Å—Ç–≤–æ–≤–∞–ª–æ —Å—Ä—ã–≤—É?</div>
                <div style={{fontSize:12,color:theme.subtext,marginTop:4}}>–û—Ç–º–µ—á–∞–π –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –≤—Å–µ –ø—Ä–∏—á–∏–Ω—ã ‚Äî —ç—Ç–æ –ø–æ–º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–µ–¥—É–≥–∞–¥—ã–≤–∞—Ç—å —Å—Ä—ã–≤—ã</div>
                <div style={{display:'flex',gap:8,flexWrap:'wrap',marginTop:8}}>
                  {BINGE_CONTEXT.map(r=> (
                    <Pill key={r} theme={theme} active={bingeCtx.includes(r)} onClick={()=>toggleCtx(r)}>{r}</Pill>
                  ))}
                </div>
                <div style={{display:'flex',gap:8,marginTop:12}}>
                  <button style={btnGhost(theme)} onClick={prev}>–ù–∞–∑–∞–¥</button>
                  <button style={btnPrimary(theme)} onClick={finish}>–ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
                </div>
              </div>
            )}

            {((step===4 && showReasons) || (step===3 && !showReasons)) && binge!=='–¥–∞' && (
              <div style={{display:'flex',gap:8,marginTop:12}}>
                <button style={btnGhost(theme)} onClick={prev}>–ù–∞–∑–∞–¥</button>
                <button style={btnPrimary(theme)} onClick={finish}>–ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
              </div>
            )}

          </CardBody>
        </Card>
      );
    }

    // ====== –†–µ–∑—É–ª—å—Ç–∞—Ç—ã (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã) ======
    function Results({theme,data,onBack}){
      const { hunger, reasons, mood, binge, binge_context } = data;

      // –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã: 1) –µ—Å–ª–∏ –±—ã–ª —Å—Ä—ã–≤ ‚Äî —Å–æ–≤–µ—Ç—ã –ø–æ—Å–ª–µ —Å—Ä—ã–≤–∞
      if (binge==='–¥–∞'){
        const inCtx = (k)=> (binge_context||[]).includes(k);
        return (
          <Card theme={theme}>
            <CardHeader theme={theme} title="–°–æ–≤–µ—Ç—ã –ø–æ—Å–ª–µ —Å—Ä—ã–≤–∞" tone='brand' />
            <CardBody>
              <div style={{lineHeight:1.6}}>
                <div>–¢—ã —É–∂–µ –º–æ–ª–æ–¥–µ—Ü ‚Äî –ø—Ä–∞–≤–¥–∞. –¢–æ—á–Ω–æ –µ—Å—Ç—å –∑–∞ —á—Ç–æ —Å–µ–±—è –ø–æ—Ö–≤–∞–ª–∏—Ç—å. –î–∞–ª—å—à–µ ‚Äî –Ω–µ—Å–∫–æ–ª—å–∫–æ –º—è–≥–∫–∏—Ö –∏–¥–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥—É—Ç –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –±–∞–ª–∞–Ω—Å—É:</div>
                <ul style={{marginTop:10,paddingLeft:16}}>
                  {inCtx('–∞–ª–∫–æ–≥–æ–ª—å') && <li>üç∑ –ï—Å–ª–∏ –ø—Ä–µ–¥—Å—Ç–æ–∏—Ç –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ —Å –∞–ª–∫–æ–≥–æ–ª–µ–º ‚Äî –Ω–∞—á–Ω–∏ —Å –ª—ë–≥–∫–æ–π –º—è—Å–Ω–æ–π/—Ä—ã–±–Ω–æ–π –∑–∞–∫—É—Å–∫–∏ –∏ —Å–∞–ª–∞—Ç–∞, —á–µ—Ä–µ–¥—É–π –∞–ª–∫–æ–≥–æ–ª—å–Ω—ã–µ –Ω–∞–ø–∏—Ç–∫–∏ —Å –≤–æ–¥–æ–π, –≤—ã–±–∏—Ä–∞–π –Ω–µ—Å–ª–∞–¥–∫–∏–µ –∫–æ–∫—Ç–µ–π–ª–∏, —Å—É—Ö–æ–µ –≤–∏–Ω–æ –∏–ª–∏ –Ω–µ–º–Ω–æ–≥–æ –∫—Ä–µ–ø–∫–æ–≥–æ –Ω–∞–ø–∏—Ç–∫–∞ –≤ —á–∏—Å—Ç–æ–º –≤–∏–¥–µ (–∫–æ–Ω—å—è–∫, –≤–∏—Å–∫–∏, —Ä–æ–º).</li>}
                  {(inCtx('–µ–¥–∞ –≤ –∫–æ–º–ø–∞–Ω–∏–∏')||inCtx('—É —Ä–æ–¥–∏—Ç–µ–ª–µ–π')||inCtx('–≤—ã—Ö–æ–¥–Ω—ã–µ')) && <li>üëú –ï—Å–ª–∏ –ø–æ –ø–ª–∞–Ω—É –µ–¥–∞ –≤–Ω–µ –¥–æ–º–∞ ‚Äî –ø–æ–ª–æ–∂–∏ –≤ —Å—É–º–æ—á–∫—É –º–∏–Ω–∏‚Äë–Ω–∞–±–æ—Ä: –ø–∞–∫–µ—Ç–∏–∫ —Ç—ã–∫–≤–µ–Ω–Ω—ã—Ö —Å–µ–º–µ—á–µ–∫ (–∫–∞–∫ –∑–∞–º–µ–Ω–∞ –¥–µ—Å–µ—Ä—Ç–∞); –ø—Å–∏–ª–ª–∏—É–º 1‚Äì2 —á. –ª. (—Ä–∞—Å—Ç–≤–æ—Ä–∏—Ç—å –≤ –≤–æ–¥–µ –∑–∞ 10‚Äì20 –º–∏–Ω –¥–æ –∑–∞—Å—Ç–æ–ª—å—è) ‚Äî –ø–æ–º–æ–∂–µ—Ç –Ω–µ –ø–µ—Ä–µ–µ–¥–∞—Ç—å.</li>}
                  {(inCtx('–µ–¥–∞ –≤ –∫–æ–º–ø–∞–Ω–∏–∏')||inCtx('—É —Ä–æ–¥–∏—Ç–µ–ª–µ–π')) && <li>üè† –ï—Å–ª–∏ –≤ –≥–æ—Å—Ç—è—Ö –Ω–µ —É–¥–æ–±–Ω–æ –æ—Ç–∫–∞–∑—ã–≤–∞—Ç—å—Å—è –æ—Ç –µ–¥—ã: –ø—Ä–æ–±—É–π –±–ª—é–¥–∞ –º–∞–ª–µ–Ω—å–∫–∏–º–∏ –ø–æ—Ä—Ü–∏—è–º–∏, –µ—à—å –±–æ–ª—å—à–µ –æ–≤–æ—â–µ–π, –¥–µ–ª–∞–π –ø–∞—É–∑—ã –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –Ω–æ–≤—ã–º –±–ª—é–¥–æ–º, –ø—Ä–æ–≤–µ—Ä—è—è —É—Ä–æ–≤–µ–Ω—å –≥–æ–ª–æ–¥–∞.</li>}
                  {inCtx('–≤—ã—Ö–æ–¥–Ω—ã–µ') && <li>üìÖ –ù–∞ –≤—ã—Ö–æ–¥–Ω—ã—Ö –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –Ω–æ–≤—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏ –ø–æ–º–æ–≥—É—Ç: –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –∑–∞–≤—Ç—Ä–∞–∫, –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞—Ä–∞–Ω–µ–µ –ø—Ä–∏—ë–º—ã –ø–∏—â–∏ –±–µ–∑ –±–æ–ª—å—à–∏—Ö –ø–µ—Ä–µ—Ä—ã–≤–æ–≤ –ø–æ –≤—Ä–µ–º–µ–Ω–∏, –±–æ–ª—å—à–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.</li>}
                </ul>
              </div>
              <div style={{marginTop:12}}>
                <button style={btnPrimary(theme)} onClick={onBack}>‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —á–µ–∫‚Äë–∏–Ω—É</button>
              </div>
            </CardBody>
          </Card>
        );
      }

      // 2) –ø–ª–æ—Ö–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –ò–õ–ò –ø—Ä–∏—á–∏–Ω—ã –≤–∫–ª—é—á–∞—é—Ç —Å–∫—É–∫–∞/—Å—Ç—Ä–µ—Å—Å/—É—Å—Ç–∞–ª–æ—Å—Ç—å ‚Üí —Å–ø–∏—Å–æ–∫ —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–π
      const emotionalReasons = ['—Å–∫—É–∫–∞','—Å—Ç—Ä–µ—Å—Å','—É—Å—Ç–∞–ª–æ—Å—Ç—å'];
      const hasEmo = (reasons||[]).some(r=> emotionalReasons.includes(r)) || mood==='–ø–ª–æ—Ö–æ–µ';
      if (hasEmo) {
        return (
          <Card theme={theme}>
            <CardHeader theme={theme} title="–í–æ–∑–º–æ–∂–µ–Ω \"—ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π\" –≥–æ–ª–æ–¥" tone='brand' />
            <CardBody>
              <div>–û—Ç–≤–ª–µ–∫–∏—Å—å –∏ –≤—ã–±–µ—Ä–∏ –æ–¥–Ω–æ –¥–µ–ª–æ –∏–∑ ¬´–°–ø–∏—Å–∫–∞ —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–π¬ª. –ù–∞–ø—Ä–∏–º–µ—Ä:</div>
              <ul style={{marginTop:10,paddingLeft:16}}>
                <li>üéß –ü–æ—Å–ª—É—à–∞—Ç—å –ª—é–±–∏–º—ã–π —Ç—Ä–µ–∫</li>
                <li>üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å –±–ª–∏–∑–∫–∏–º</li>
                <li>üçµ –ù–∞–ª–∏—Ç—å —á–∞–π–∫—É</li>
                <li>‚úèÔ∏è –ü–æ—á–µ—Ä—Ç–∏—Ç—å/–ø–æ—Ä–∏—Å–æ–≤–∞—Ç—å</li>
                <li>üìù –ü–æ–ø–∏—Å–∞—Ç—å –≤—Å—ë, —á—Ç–æ –ø—Ä–∏–¥—ë—Ç –≤ –≥–æ–ª–æ–≤—É</li>
                <li>ü™ú –ü—Ä–æ–π—Ç–∏—Å—å –ø–æ –ª–µ—Å—Ç–Ω–∏—Ü–µ</li>
                <li>üóìÔ∏è –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏—è—Ç–Ω–æ—Å—Ç—å –Ω–∞ –≤–µ—á–µ—Ä/–≤—ã—Ö–æ–¥–Ω—ã–µ</li>
              </ul>
              <div style={{marginTop:12}}>
                <button style={btnPrimary(theme)} onClick={onBack}>‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —á–µ–∫‚Äë–∏–Ω—É</button>
              </div>
            </CardBody>
          </Card>
        );
      }

      // 3) –µ—Å–ª–∏ –≥–æ–ª–æ–¥>2 –∏ —Å—Ä–µ–¥–∏ –ø—Ä–∏—á–∏–Ω –µ—Å—Ç—å ¬´–¥–∞–≤–Ω–æ –µ–ª–∞¬ª ‚Üí —Ç–∞—Ä–µ–ª–∫–∞ (–Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å, –µ—Å–ª–∏ —É–∂–µ –≤—ã–≤–µ–¥–µ–Ω–æ)
      if (hunger>2 && (reasons||[]).includes('–¥–∞–≤–Ω–æ –µ–ª–∞')){
        return (
          <Card theme={theme}>
            <CardHeader theme={theme} title="–ü–æ–µ—à—å)" tone='brand' />
            <CardBody>
              <div style={{fontSize:12,color:theme.subtext,marginBottom:6}}>–í–æ—Ç –∏–¥–µ–∏ –∫–∞–∫ —Å–æ–±—Ä–∞—Ç—å —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Ç–∞—Ä–µ–ª–∫—É, –∫–æ—Ç–æ—Ä–∞—è –Ω–∞–ø–æ–ª–Ω–∏—Ç —ç–Ω–µ—Ä–≥–∏—é</div>
              <div>1/4 —Ç–∞—Ä–µ–ª–∫–∏ –±–µ–ª–∫–∏ + 1/4 —Å–ª–æ–∂–Ω—ã–µ —É–≥–ª–µ–≤–æ–¥—ã + 1/2 –æ–≤–æ—â–∏ + –Ω–µ–º–Ω–æ–≥–æ –ø–æ–ª–µ–∑–Ω—ã—Ö –∂–∏—Ä–æ–≤.<br/>–ù–∞–ø—Ä–∏–º–µ—Ä: —Ä—ã–±–∞/–∫—É—Ä–∏—Ü–∞/—è–π—Ü–æ + –≥—Ä–µ—á–∫–∞/–∫–∏–Ω–æ–∞/—Ü–µ–ª—å–Ω–æ–∑–µ—Ä–Ω–æ–≤–æ–π —Ö–ª–µ–± + —Å–∞–ª–∞—Ç –∏–ª–∏ –∑–∞–ø–µ—á—ë–Ω–Ω—ã–µ –æ–≤–æ—â–∏ + –æ–ª–∏–≤–∫–æ–≤–æ–µ –º–∞—Å–ª–æ —Å –ª–∏–º–æ–Ω–Ω—ã–º —Å–æ–∫–æ–º.</div>
              <div style={{marginTop:12}}>
                <button style={btnPrimary(theme)} onClick={onBack}>‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —á–µ–∫‚Äë–∏–Ω—É</button>
              </div>
            </CardBody>
          </Card>
        );
      }

      // 4) ¬´–≤—Å—ë —Ö–æ—Ä–æ—à–æ¬ª ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–π —Ç–µ–∫—Å—Ç
      return (
        <Card theme={theme}>
          <CardHeader theme={theme} title="–û—Ç–ª–∏—á–Ω—ã–π –∫—É—Ä—Å!" tone='brand' />
          <CardBody>
            <div>–ü–æ—Ö–æ–∂–µ, —Å–µ–π—á–∞—Å –≤—Å—ë —Å–ø–æ–∫–æ–π–Ω–æ: –≥–æ–ª–æ–¥–∞ –Ω–µ—Ç, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—é –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ, —Å—Ä—ã–≤–∞ –Ω–µ –±—ã–ª–æ. –ü—Ä–æ–¥–æ–ª–∂–∞–π –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ, –º—è–≥–∫–æ –∑–∞–º–µ—á–∞–π —Å–∏–≥–Ω–∞–ª—ã —Ç–µ–ª–∞ –∏ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞–π—Å—è –∫ —á–µ–∫‚Äë–∏–Ω—É ‚Äî —Ç–∞–∫ —Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—à—å —É—Å—Ç–æ–π—á–∏–≤—ã–π —Ä–∏—Ç–º –∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ —Å–µ–±–µ. –Ø —Ä—è–¥–æ–º üíö</div>
            <div style={{marginTop:12}}>
              <button style={btnPrimary(theme)} onClick={onBack}>‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —á–µ–∫‚Äë–∏–Ω—É</button>
            </div>
          </CardBody>
        </Card>
      );
    }

    // ====== Header (–≤–µ—Ä—Ö–Ω–∏–µ –∑–µ–ª—ë–Ω—ã–µ –∫–Ω–æ–ø–∫–∏) ======
    function Header({theme,onOpenProtocol,onRelapse}){
      const bigOutline = {...btnOutline(theme)};
      return (
        <div style={{display:'grid',gap:8,marginBottom:16}}>
          <div style={{textAlign:'center',marginBottom:12}}>
            <div style={{fontSize:24,fontWeight:800}}>–ê–Ω—Ç–∏—Å—Ä—ã–≤</div>
          </div>
          <div style={{textAlign:'center',fontSize:14,fontWeight:700,color:theme.text}}>–ù–∞–∂–º–∏, –µ—Å–ª–∏</div>
          <div style={{display:'flex',gap:8,justifyContent:'center',flexWrap:'wrap'}}>
            <button onClick={onOpenProtocol} style={bigOutline}>–û—á–µ–Ω—å —Ö–æ—á–µ—Ç—Å—è üî•</button>
            <button onClick={onRelapse} style={bigOutline}>–°–æ—Ä–≤–∞–ª–∞—Å—å üíî</button>
          </div>
        </div>
      )
    }

    // ====== –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ======
    const App = () => {
      const theme = useTheme();
      const [view,setView] = React.useState('home'); // home|stop|relapse_info|water|foods|results
      const [resultsData,setResultsData] = React.useState(null);

      React.useEffect(()=>{ logEvent('app_open'); },[]);

      return (
        <div style={{background:theme.bg,color:theme.text,minHeight:"100%"}}>
          <div style={{maxWidth:560,margin:"0 auto",padding:16}}>
            <Header theme={theme} onOpenProtocol={()=>{ setView('stop'); logEvent('open_protocol'); }} onRelapse={()=>{ setView('relapse_info'); logEvent('relapse_info_open'); }} />

            {view==='stop' && <StopProtocol theme={theme} onBack={()=> setView('home')} />}
            {view==='relapse_info' && <RelapseInfo theme={theme} onBack={()=> setView('home')} />}

            {view==='water' && <WaterGuide theme={theme} onBack={()=> setView('home')} />}
            {view==='foods' && <FoodsList theme={theme} onBack={()=> setView('home')} />}

            {view==='home' && (
              <>
                <Checkin theme={theme} onDone={(data)=>{ setResultsData(data); setView('results'); logEvent('checkin_done',{...data}); }} />
                <Materials theme={theme} onOpenWater={()=>{ setView('water'); logEvent('materials_click',{materials_click:'water_guide'}) }} onOpenFoods={()=>{ setView('foods'); logEvent('materials_click',{materials_click:'foods'}) }} />
              </>
            )}

            {view==='results' && resultsData && <Results theme={theme} data={resultsData} onBack={()=> setView('home')} />}
          </div>
        </div>
      )
    }

    // ====== –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ======
    (function mount(){
      try{
        if(typeof ReactDOM==='object' && ReactDOM.createRoot && typeof React==='object'){
          const container = document.getElementById('root');
          const root = ReactDOM.createRoot(container);
          root.render(<App />);
        } else { setTimeout(mount, 16); }
      }catch(e){ __showFatal(e); throw e; }
    })();
  </script>
</body>
</html>
