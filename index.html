<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–ê–Ω—Ç–∏—Å—Ä—ã–≤ ‚Äî Telegram Mini App</title>
  <meta name="theme-color" content="#2563eb" />
  <style>
    html,body{height:100%;margin:0}
    body{background:#fff;color:#1f2937;font-family:ui-sans-serif,system-ui,-apple-system,Roboto,Helvetica,Arial}
    body,button{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
  </style>
  <!-- Telegram Web Apps SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <!-- React 18 UMD -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- Babel (–¥–ª—è –∑–∞–ø—É—Å–∫–∞ –±–µ–∑ —Å–±–æ—Ä–∫–∏) -->
  <script src="https://unpkg.com/@babel/standalone@7/babel.min.js"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const {useEffect,useMemo,useState} = React;

    // ===== UTILS =====
    function get(obj, path, fallback) {
      try{
        var cur=obj;
        for (var i=0;i<path.length;i++){ if(cur==null) return fallback; cur=cur[path[i]]; }
        return cur==null?fallback:cur;
      }catch(_){return fallback;}
    }
    function useTelegram(){
      const tg = React.useMemo(function(){
        if (typeof window === "undefined") return undefined;
        return get(window, ["Telegram","WebApp"], undefined);
      },[]);
      return tg;
    }
    function useTheme(tg){
      const [theme,setTheme] = useState({
        bg:"#ffffff", text:"#1f2937", subtext:"#6b7280",
        accent:"#2563eb", card:"#f3f4f6", border:"#e5e7eb"
      });
      useEffect(function(){
        if(!tg) return;
        var bg=(tg.themeParams&&tg.themeParams.bg_color)||theme.bg;
        var text=(tg.themeParams&&tg.themeParams.text_color)||theme.text;
        var hint=(tg.themeParams&&tg.themeParams.hint_color)||theme.subtext;
        var button=(tg.themeParams&&tg.themeParams.button_color)||theme.accent;
        var secondaryBg=(tg.themeParams&&tg.themeParams.secondary_bg_color)||theme.card;
        setTheme({bg:bg, text:text, subtext:hint, accent:button, card:secondaryBg, border:"#e5e7eb"});
      },[tg]);
      return theme;
    }

    // –ü–æ—Ä—è–¥–æ–∫ —à–∞–≥–æ–≤
    var steps=["carbs","water","mood","urge","binge"];

    // ===== LOGIC =====
    function pickPrimaryAdvice(state){
      var s=state||{}; var urgeVal = isFinite(s.urge)? s.urge : 0;
      if(s.binge===true){
        return { title:"–ï—Å–ª–∏ –±—ã–ª —ç–ø–∏–∑–æ–¥ —Å—Ä—ã–≤–∞/–ø–µ—Ä–µ–µ–¥–∞–Ω–∏—è ‚Äî –º—è–≥–∫–∏–π –≤–æ–∑–≤—Ä–∞—Ç",
          items:["‚è∞ –õ–æ–∂–∏—Å—å –≤–æ–≤—Ä–µ–º—è (–¥–æ 23:00)","üç≥ –ë–µ–ª–∫–∏+–º–µ–¥–ª–µ–Ω–Ω—ã–µ —É–≥–ª–µ–≤–æ–¥—ã —É—Ç—Ä–æ–º",
                 "üö∂ –ö–æ—Ä–æ—Ç–∫–∞—è –ø—Ä–æ–≥—É–ª–∫–∞ –¥–Ω—ë–º",
                 "üçΩ –û–±—ã—á–Ω—ã–π —É–∂–∏–Ω –±–µ–∑ ¬´–∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–π¬ª, –Ω–∏–∫–∞–∫–∏—Ö –Ω–∞–∫–∞–∑–∞–Ω–∏–π"] };
      }
      if(urgeVal>=2){
        return { title:"–¢—è–≥–∞ ‚â• 2 ‚Äî –ø–æ–¥–∫–ª—é—á–∞–µ–º –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å –∏ ¬´–°—Ç–æ–ø-–ø—Ä–æ—Ç–æ–∫–æ–ª¬ª",
          items:["–ï—Å–ª–∏ –µ–ª–∞ –±–æ–ª–µ–µ 3 —á–∞—Å–æ–≤ –Ω–∞–∑–∞–¥: —Å–æ–±–µ—Ä–∏ –∑–¥–æ—Ä–æ–≤—É—é —Ç–∞—Ä–µ–ª–∫—É / –ø–µ—Ä–µ–∫—É—Å–∏ –≥–æ—Ä—Å—Ç—å—é —Ç—ã–∫–≤–µ–Ω–Ω—ã—Ö —Å–µ–º–µ—á–µ–∫",
                 "–ï—Å–ª–∏ –≥–æ–ª–æ–¥ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π ‚Üí –∑–∞–º–µ–Ω–∏ –¥–µ–π—Å—Ç–≤–∏–µ–º: –ø—Ä–æ–≥—É–ª–∫–∞, –º—É–∑—ã–∫–∞, –¥—É—à –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –ø–æ–ª–µ–∂–∞—Ç—å 15 –º–∏–Ω—É—Ç",
                 "–ï—Å–ª–∏ —Ç—è–≥–∞ –∫ —Å–ª–∞–¥–∫–æ–º—É –Ω–µ —É—à–ª–∞ ‚Üí —Ä–∞–∑—Ä–µ—à–∏ —Å–µ–±–µ –º–∞–ª–µ–Ω—å–∫—É—é –ø–æ—Ä—Ü–∏—é (—Å—É—Ö–æ—Ñ—Ä—É–∫—Ç—ã –∏–ª–∏ –Ω–∞—Ç—É—Ä–∞–ª—å–Ω–∞—è –ø–∞—Å—Ç–∏–ª–∞)",
                 "–ü–æ–¥—Ä–æ–±–Ω–µ–µ –ø–æ –∫–Ω–æ–ø–∫–µ –°—Ç–æ–ø-–ø—Ä–æ—Ç–æ–∫–æ–ª"] };
      }
      if(s.carbs_ok===false){
        return { title:"–ù–µ–¥–æ–±–æ—Ä –º–µ–¥–ª–µ–Ω–Ω—ã—Ö —É–≥–ª–µ–≤–æ–¥–æ–≤ –∏ –±–µ–ª–∫–∞",
          items:["–ü–µ—Ä–µ–∫—É—Å: –æ–≤–æ—â/—Ñ—Ä—É–∫—Ç + –π–æ–≥—É—Ä—Ç/—Ç–≤–æ—Ä–æ–≥ –∏–ª–∏ —è–π—Ü–æ",
                 "–ö —É–∂–∏–Ω—É –∫—Ä–∞—Ö–º–∞–ª–∏—Å—Ç—ã–π –≥–∞—Ä–Ω–∏—Ä + —Ä—ã–±–∞/–∫—É—Ä–∏—Ü–∞/–∫—Ä–µ–≤–µ—Ç–∫–∏/—è–π—Ü–æ",
                 "–û—Ä–∏–µ–Ω—Ç–∏—Ä: 1‚Äì2 –ª–∞–¥–æ–Ω–∏ —Å–ª–æ–∂–Ω—ã—Ö —É–≥–ª–µ–≤–æ–¥–æ–≤ + 1‚Äì2 –ª–∞–¥–æ–Ω–∏ –±–µ–ª–∫–∞"] };
      }
      if(s.water_ok===false){
        return { title:"–ú–∞–ª–æ –≤–æ–¥—ã —Å–µ–≥–æ–¥–Ω—è",
          items:["–ù–µ –¥–æ–±–∏—Ä–∞–π –æ–±—ä—ë–º –ø–æ–∑–¥–Ω–æ –≤–µ—á–µ—Ä–æ–º, —á—Ç–æ–±—ã –Ω–µ –º–µ—à–∞—Ç—å —Å–Ω—É",
                 "–ó–∞–≤—Ç—Ä–∞ –ø–æ—Å—Ç–∞—Ä–∞–π—Å—è –≤—ã–π—Ç–∏ –Ω–∞ –Ω–æ—Ä–º—É (~30 –º–ª/–∫–≥ –≤ —Å—É—Ç–∫–∏)",
                 "–ù–∞—á–Ω–∏ —É—Ç—Ä–æ —Å–æ —Å—Ç–∞–∫–∞–Ω–∞ –≤–æ–¥—ã –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–π –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è"] };
      }
      return null;
    }

    // ===== UI PRIMITIVES =====
    function Progress(props){
      var value=props.value, accent=props.accent;
      return (<div style={{marginBottom:12}}>
        <div style={{height:8,width:"100%",background:"rgba(0,0,0,0.08)",borderRadius:999}}>
          <div style={{height:8,width:value+'%',background:accent,borderRadius:999,transition:"width .25s ease"}} />
        </div>
        <div style={{fontSize:12,marginTop:6,opacity:0.75}}>{value}%</div>
      </div>);
    }
    function Section(props){
      var title=props.title, subtitle=props.subtitle, children=props.children;
      return (<div style={{marginBottom:8}}>
        <div style={{fontSize:16,fontWeight:700,marginBottom:4}}>{title}</div>
        {subtitle && <div style={{fontSize:13,opacity:0.7,marginBottom:8}}>{subtitle}</div>}
        {children}
      </div>);
    }
    function Row(props){
      return <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8}}>{props.children}</div>;
    }
    function ChoiceBtn(props){
      var active=props.active, onClick=props.onClick, children=props.children;
      return (<button onClick={onClick} style={{padding:"14px 12px",borderRadius:12,border:"1px solid "+(active?"transparent":"#e5e7eb"),background:active?"rgba(37,99,235,0.12)":"#fff",fontWeight:600}}>{children}</button>);
    }
    function btnPrimary(theme){return {padding:"12px 14px",borderRadius:12,background:theme.accent,color:"#fff",border:"none",fontWeight:700};}
    function btnOutline(theme){return {padding:"12px 14px",borderRadius:12,background:"#fff",color:theme.text, border:"1px solid "+theme.border,fontWeight:600};}

    function FoodsTable(props){
      var theme=props.theme, title=props.title, rows=props.rows;
      return (<div style={{background:"#fff",border:"1px solid "+props.theme.border,borderRadius:12,overflow:"hidden"}}>
        <div style={{padding:"8px 12px",fontWeight:600,background:"rgba(0,0,0,0.03)"}}>{title}</div>
        <table style={{width:"100%",borderCollapse:"collapse"}}><tbody>
          {rows.map(function(r,idx){return (
            <tr key={idx}>
              <td style={{verticalAlign:"top",padding:"8px 12px",borderTop:"1px solid "+theme.border,width:"34%",fontWeight:600}}>{r[0]}</td>
              <td style={{verticalAlign:"top",padding:"8px 12px",borderTop:"1px solid "+theme.border}}>{r[1]}</td>
            </tr>
          );})}
        </tbody></table>
      </div>);
    }

    // ===== SCREENS =====
    function Header(props){
      var theme=props.theme, onOpenProtocol=props.onOpenProtocol, onOpenFoods=props.onOpenFoods, onNewCheckin=props.onNewCheckin;
      return (<div style={{display:"flex",alignItems:"center",gap:12,marginBottom:12,flexWrap:"wrap"}}>
        <div style={{width:40,height:40,borderRadius:12,background:theme.card,display:"grid",placeItems:"center"}}>üõ°Ô∏è</div>
        <div>
          <div style={{fontSize:18,fontWeight:700}}>–ê–Ω—Ç–∏—Å—Ä—ã–≤</div>
          <div style={{fontSize:13,color:theme.subtext}}>–ß–µ–∫-–∏–Ω 60 —Å–µ–∫ ¬∑ –±–µ–∑ –æ—Ü–µ–Ω–æ–∫</div>
        </div>
        <div style={{marginLeft:"auto",display:"flex",gap:8,flexWrap:"wrap"}}>
          <button onClick={onOpenProtocol} style={{fontSize:13,padding:"8px 12px",borderRadius:10,border:"1px solid "+theme.border,background:theme.card}}>–°—Ç–æ–ø-–ø—Ä–æ—Ç–æ–∫–æ–ª</button>
          <button onClick={onOpenFoods} style={{fontSize:13,padding:"8px 12px",borderRadius:10,border:"1px solid "+theme.border,background:theme.card,cursor:"pointer"}}>–°–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤</button>
          <button onClick={onNewCheckin} style={btnPrimary(theme)}>–ß–µ–∫-–∏–Ω</button>
        </div>
      </div>);
    }

    function DoneCard(props){
      var theme=props.theme, state=props.state;
      var advice=pickPrimaryAdvice(state);
      return (<div style={{marginBottom:12,border:"1px solid "+theme.border,background:"#fff",borderRadius:12}}>
        <div style={{padding:10,borderBottom:"1px solid "+theme.border,background:"rgba(37,99,235,0.06)",borderTopLeftRadius:12,borderTopRightRadius:12}}>üéâ –ß–µ–∫-–∏–Ω –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω</div>
        <div style={{padding:12}}>
          {advice? (<div>
            <div style={{fontWeight:600,marginBottom:4}}>{advice.title}</div>
            <ul style={{paddingLeft:18,margin:0}}>
              {advice.items.map(function(t,idx){return <li key={idx} style={{fontSize:14,color:theme.subtext}}>{t}</li>;})}
            </ul>
          </div>) : (<div style={{fontSize:14,color:theme.subtext}}>–í—Å—ë –æ–∫ üëç –ü—Ä–æ–¥–æ–ª–∂–∞–π –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ!</div>)}
        </div>
      </div>);
    }

    function ProtocolCard(props){
      var theme=props.theme;
      return (<div style={{background:theme.card,borderRadius:16,padding:16,border:"1px solid "+theme.border}}>
        <div style={{fontWeight:700,fontSize:18,marginBottom:6}}>–°—Ç–æ–ø-–ø—Ä–æ—Ç–æ–∫–æ–ª</div>
        <div style={{fontSize:13,color:theme.subtext,marginBottom:12}}>–ï—Å–ª–∏ —Ç—è–≥–∞ –∫ —Å–ª–∞–¥–∫–æ–º—É / –≤—Ä–µ–¥–Ω–æ–º—É –≤—ã—Å–æ–∫–∞—è, –∏—Å–ø–æ–ª—å–∑—É–π —Å–ª–µ–¥—É—é—â–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏:</div>
        <div style={{display:"grid",gap:12}}>
          <div>
            <div style={{fontWeight:600,marginBottom:6}}>–®–∞–≥ 1. –°—Ç–æ–ø ‚úã</div>
            <ul style={{paddingLeft:18,margin:0}}>
              <li>–°–¥–µ–ª–∞–π –ø–∞—É–∑—É 3‚Äì5 –º–∏–Ω—É—Ç.</li>
              <li>–°–ø—Ä–æ—Å–∏ —Å–µ–±—è: ¬´–Ø –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—á—É —ç—Ç–æ —Å—ä–µ—Å—Ç—å –∏–ª–∏ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ —Ç–µ–ª—É —Å–µ–π—á–∞—Å –Ω—É–∂–Ω–æ —á—Ç–æ-—Ç–æ –¥—Ä—É–≥–æ–µ (–æ—Ç–¥—ã—Ö, —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏–µ, –ø–µ—Ä–µ—Ä—ã–≤)?¬ª.</li>
            </ul>
          </div>
          <div>
            <div style={{fontWeight:600,marginBottom:6}}>–®–∞–≥ 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ ‚öñÔ∏è</div>
            <ul style={{paddingLeft:18,margin:0}}>
              <li>–ü—Ä–æ—à–ª–æ –ª–∏ 3 —á–∞—Å–∞ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø—Ä–∏–µ–º–∞ –ø–∏—â–∏? –ï—Å–ª–∏ –¥–∞ ‚Üí –ø–æ–µ—à—å.</li>
            </ul>
          </div>
          <div>
            <div style={{fontWeight:600,marginBottom:6}}>–®–∞–≥ 3. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ üîÑ</div>
            <div style={{fontSize:14,color:theme.text,marginBottom:6}}>–ï—Å–ª–∏ –≥–æ–ª–æ–¥ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π ‚Üí –∑–∞–º–µ–Ω–∏ –¥–µ–π—Å—Ç–≤–∏–µ–º:</div>
            <ul style={{paddingLeft:18,margin:0}}>
              <li>üíß —Å—Ç–∞–∫–∞–Ω –≤–æ–¥—ã</li>
              <li>üö∂‚Äç‚ôÄÔ∏è –ø—Ä–æ–≥—É–ª–∫–∞ 5‚Äì10 –º–∏–Ω—É—Ç</li>
              <li>üßò‚Äç‚ôÄÔ∏è –¥—ã—Ö–∞–Ω–∏–µ 4‚Äì7‚Äì8: –≤–¥–æ—Ö –Ω–∞ 4 —Å—á–µ—Ç–∞, –∑–∞–¥–µ—Ä–∂–∫–∞ –Ω–∞ 7, –≤—ã–¥–æ—Ö –Ω–∞ 8</li>
              <li>üé∂ –º—É–∑—ã–∫–∞, –¥—É—à –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –ø–æ–ª–µ–∂–∞—Ç—å 15 –º–∏–Ω—É—Ç</li>
            </ul>
          </div>
          <div>
            <div style={{fontWeight:600,marginBottom:6}}>–®–∞–≥ 4. –û—Å–æ–∑–Ω–∞–Ω–Ω—ã–π –≤—ã–±–æ—Ä üçè</div>
            <ul style={{paddingLeft:18,margin:0}}>
              <li>–°–∫–∞–∂–∏ —Å–µ–±–µ: ¬´–Ø –∫–æ—Ä–º–ª—é —Ç–µ–ª–æ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏ –∑–¥–æ—Ä–æ–≤—å—è, –∞ –Ω–µ –∑–∞–µ–¥–∞—é —ç–º–æ—Ü–∏–∏¬ª.</li>
              <li>–°–æ–±–µ—Ä–∏ —Ç–∞—Ä–µ–ª–∫—É –∏–∑ –æ–≤–æ—â–µ–π/—Å–∞–ª–∞—Ç–∞, –º–µ–¥–ª–µ–Ω–Ω—ã—Ö —É–≥–ª–µ–≤–æ–¥–æ–≤, –±–µ–ª–∫–æ–≤ –∏ –∂–∏—Ä–æ–≤.</li>
              <li>–ï—à—å –º–µ–¥–ª–µ–Ω–Ω–æ, –Ω–∞—Å–ª–∞–∂–¥–∞—è—Å—å –≤–∫—É—Å–æ–º.</li>
              <li>–ï—Å–ª–∏ —Ç—è–≥–∞ –∫ —Å–ª–∞–¥–∫–æ–º—É –Ω–µ —É—à–ª–∞ ‚Üí —Ä–∞–∑—Ä–µ—à–∏ —Å–µ–±–µ –º–∞–ª–µ–Ω—å–∫—É—é –ø–æ—Ä—Ü–∏—é, –Ω–æ —Å —Ç–∞—Ä–µ–ª–∫–∏, –±–µ–∑ –µ–¥—ã ¬´–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–µ¬ª. –í—ã–±–∏—Ä–∞–π —Å—É—Ö–æ—Ñ—Ä—É–∫—Ç—ã –∏–ª–∏ –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—É—é –ø–∞—Å—Ç–∏–ª—É.</li>
            </ul>
          </div>
          <div>
            <div style={{fontWeight:600,marginBottom:6}}>–®–∞–≥ 5. –†–∞–∑–±–æ—Ä ‚úçÔ∏è</div>
            <ul style={{paddingLeft:18,margin:0}}>
              <li>–°–ø—Ä–æ—Å–∏ —Å–µ–±—è: ¬´–ß—Ç–æ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ —è —Ö–æ—Ç–µ–ª–∞ –∑–∞–∫—Ä—ã—Ç—å? –£—Å—Ç–∞–ª–æ—Å—Ç—å? –ù–∞–ø—Ä—è–∂–µ–Ω–∏–µ? –ñ–µ–ª–∞–Ω–∏–µ –æ—Ç–¥–æ—Ö–Ω—É—Ç—å?¬ª –û—Ç–º–µ—á–∞–π, –≤ –∫–∞–∫–∏—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö —Ç—è–≥–∞ –æ—Å–æ–±–µ–Ω–Ω–æ —Å–∏–ª—å–Ω–∞—è.</li>
            </ul>
          </div>
          <div style={{marginTop:4,padding:10,border:"1px dashed "+theme.border,borderRadius:12,background:"#fff"}}>
            –°–æ–≤–µ—Ç: –ø–æ–¥–≥–æ—Ç–æ–≤—å –∑–∞—Ä–∞–Ω–µ–µ ¬´–°–ø–∏—Å–æ–∫ —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–π¬ª ‚Äî –ø—Ä–æ—Å—Ç—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –Ω–∞ 5‚Äì20 –º–∏–Ω—É—Ç, –∫–æ—Ç–æ—Ä—ã–π —Ç—ã —Å–º–æ–∂–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, –∫–æ–≥–¥–∞ —á—É–≤—Å—Ç–≤—É–µ—à—å —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –≥–æ–ª–æ–¥.
          </div>
        </div>
      </div>);
    }

    function FoodsCard(props){
      var theme=props.theme;
      function go(id){ try{ var el=document.getElementById(id); if(el&&el.scrollIntoView) el.scrollIntoView({behavior:"smooth",block:"start"});}catch(_){} }
      return (<div style={{background:props.theme.card,borderRadius:16,padding:16,border:"1px solid "+props.theme.border}}>
        <div style={{fontWeight:700,fontSize:18,marginBottom:6}}>–ü—Ä–æ–¥—É–∫—Ç—ã –¥–ª—è –∑–¥–æ—Ä–æ–≤—å—è</div>
        <div style={{fontSize:13,color:theme.subtext,marginBottom:12}}>–û—Ä–∏–µ–Ω—Ç–∏—Ä —Ç–∞—Ä–µ–ª–∫–∏: 1/2 –∫–ª–µ—Ç—á–∞—Ç–∫–∞ ¬∑ 1/4 –±–µ–ª–æ–∫ ¬∑ 1/4 —Å–ª–æ–∂–Ω—ã–µ —É–≥–ª–µ–≤–æ–¥—ã + –ø–æ–ª–µ–∑–Ω—ã–µ –∂–∏—Ä—ã.</div>
        <div style={{display:"flex",flexWrap:"wrap",gap:8,marginBottom:12}}>
          {[{id:"p-animal",label:"–ë–µ–ª–∫–∏"},{id:"carbs",label:"–£–≥–ª–µ–≤–æ–¥—ã"},{id:"fiber",label:"–ö–ª–µ—Ç—á–∞—Ç–∫–∞"},{id:"fats",label:"–ñ–∏—Ä—ã"}].map(function(link){
            return (<button key={link.id} onClick={function(){go(link.id);}} style={{fontSize:13,padding:"6px 10px",borderRadius:999,border:"1px solid #e5e7eb",background:"#fff",textDecoration:"underline",cursor:"pointer"}}>{link.label}</button>);
          })}
        </div>
        <div style={{display:"grid",gap:12}}>
          <div id="p-animal">
            <FoodsTable theme={theme} title="üçó –ë–ï–õ–û–ö (¬º —Ç–∞—Ä–µ–ª–∫–∏)"
              rows={[
                ["–ú—è—Å–æ/–ø—Ç–∏—Ü–∞","–≥–æ–≤—è–¥–∏–Ω–∞, –∫—É—Ä–∏—Ü–∞, –∏–Ω–¥–µ–π–∫–∞, —Ç–µ–ª—è—Ç–∏–Ω–∞, –∫—Ä–æ–ª–∏–∫, –ø–µ—Ä–µ–ø–µ–ª–∫–∞"],
                ["–†—ã–±–∞","–ª–æ—Å–æ—Å—å, —Ñ–æ—Ä–µ–ª—å, —Ç—É–Ω–µ—Ü, —Ç—Ä–µ—Å–∫–∞, —Å–∞—Ä–¥–∏–Ω—ã, –¥–æ—Ä–∞–¥–æ, —Å–∏–±–∞—Å"],
                ["–ú–æ—Ä–µ–ø—Ä–æ–¥—É–∫—Ç—ã","–∫—Ä–µ–≤–µ—Ç–∫–∏, –º–∏–¥–∏–∏, –∫–∞–ª—å–º–∞—Ä—ã"],
                ["–Ø–π—Ü–∞","—è–π—Ü–∞ –∫—É—Ä–∏–Ω—ã–µ/–ø–µ—Ä–µ–ø–µ–ª–∏–Ω—ã–µ"],
                ["–°—ã—Ä","–Ω–µ–∂–∏—Ä–Ω—ã–π –∫–æ–∑–∏–π —Å—ã—Ä (2‚Äì3 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é)"]
              ]}
            />
          </div>
          <div id="p-plant">
            <FoodsTable theme={theme} title="üå± –†–∞—Å—Ç–∏—Ç–µ–ª—å–Ω—ã–π –±–µ–ª–æ–∫"
              rows={[
                ["–ë–æ–±–æ–≤—ã–µ","—á–µ—á–µ–≤–∏—Ü–∞, –Ω—É—Ç, –º–∞—à, —Ñ–∞—Å–æ–ª—å, –≥–æ—Ä–æ—Ö"],
                ["–ü—Å–µ–≤–¥–æ–∑–µ—Ä–Ω–æ–≤—ã–µ","–∫–∏–Ω–æ–∞, –∞–º–∞—Ä–∞–Ω—Ç, –≥—Ä–µ—á–∫–∞"],
                ["–û—Ä–µ—Ö–∏ –∏ —Å–µ–º–µ—á–∫–∏","–º–∏–Ω–¥–∞–ª—å, –∫–µ—à—å—é, —Ç—ã–∫–≤–µ–Ω–Ω—ã–µ —Å–µ–º–µ—á–∫–∏, —á–∏–∞"],
                ["–ì—Ä–∏–±—ã","—à–∞–º–ø–∏–Ω—å–æ–Ω—ã, –≤–µ—à–µ–Ω–∫–∏"],
                ["–°–æ–µ–≤—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã","—Ç–æ—Ñ—É, —Å–æ–µ–≤–æ–µ –º–æ–ª–æ–∫–æ"]
              ]}
            />
          </div>
          <div id="carbs">
            <FoodsTable theme={theme} title="üçö –£–ì–õ–ï–í–û–î–´ (¬º —Ç–∞—Ä–µ–ª–∫–∏) ‚Äî —Å–ª–æ–∂–Ω—ã–µ"
              rows={[
                ["–ö—Ä—É–ø—ã","–æ–≤—Å—è–Ω–∫–∞, –≥—Ä–µ—á–∫–∞, –±—É—Ä—ã–π –∏ –¥–∏–∫–∏–π —Ä–∏—Å, –ø–µ—Ä–ª–æ–≤–∫–∞, –∫–∏–Ω–æ–∞, –ø—à–µ–Ω–æ"],
                ["–•–ª–µ–±/–ø–∞—Å—Ç–∞","—Ü–µ–ª—å–Ω–æ–∑–µ—Ä–Ω–æ–≤—ã–µ —Ö–ª–µ–±—Ü—ã/–ª–∞–≤–∞—à, –ø–∞—Å—Ç–∞ –∏–∑ —Ç–≤—ë—Ä–¥—ã—Ö —Å–æ—Ä—Ç–æ–≤"],
                ["–ë–æ–±–æ–≤—ã–µ","—Ñ–∞—Å–æ–ª—å, —á–µ—á–µ–≤–∏—Ü–∞, –≥–æ—Ä–æ—Ö"],
                ["–ö—Ä–∞—Ö–º–∞–ª–∏—Å—Ç—ã–µ –æ–≤–æ—â–∏","–∫–∞—Ä—Ç–æ—Ñ–µ–ª—å, –±–∞—Ç–∞—Ç, —Ç—ã–∫–≤–∞"]
              ]}
            />
          </div>
          <div id="fiber">
            <div style={{fontWeight:700,fontSize:16}}>ü•¶ –ö–õ–ï–¢–ß–ê–¢–ö–ê (¬Ω —Ç–∞—Ä–µ–ª–∫–∏)</div>
            <div style={{fontSize:13,color:theme.subtext}}>–ö–ª–µ—Ç—á–∞—Ç–∫–∞ –æ—á–µ–Ω—å –≤–∞–∂–Ω–∞‚ÄºÔ∏è –ü–æ–º–æ–≥–∞–µ—Ç –∫–∏—à–µ—á–Ω–∏–∫—É, —Å–Ω–∏–∂–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å –≥–ª—é–∫–æ–∑—ã –∏ –¥–∞—ë—Ç –Ω–∞—Å—ã—â–µ–Ω–∏–µ.</div>
            <FoodsTable theme={theme} title="–û–≤–æ—â–∏"
              rows={[
                ["–ö–∞–ø—É—Å—Ç—ã","–±—Ä–æ–∫–∫–æ–ª–∏, —Ü–≤–µ—Ç–Ω–∞—è, –±–µ–ª–æ–∫–æ—á–∞–Ω–Ω–∞—è, –±—Ä—é—Å—Å–µ–ª—å—Å–∫–∞—è"],
                ["–ö–æ—Ä–Ω–µ–ø–ª–æ–¥—ã –∏ –¥—Ä.","–º–æ—Ä–∫–æ–≤—å, —Å–≤—ë–∫–ª–∞, –∫–∞–±–∞—á–æ–∫, —Ç—ã–∫–≤–∞, –±–∞—Ç–∞—Ç, —Å–µ–ª—å–¥–µ—Ä–µ–π"],
                ["–û–≤–æ—â–∏ —Å –º–µ–Ω—å—à–µ–π –∫–ª–µ—Ç—á–∞—Ç–∫–æ–π","—Ä–µ–¥–∏—Å, –æ–≥—É—Ä–µ—Ü, –ø–æ–º–∏–¥–æ—Ä, –ø–µ—Ä–µ—Ü"]
              ]}
            />
            <FoodsTable theme={theme} title="–ó–µ–ª–µ–Ω—å"
              rows={[[ "–ü—Ä–∏–º–µ—Ä—ã","–ø–µ—Ç—Ä—É—à–∫–∞, —É–∫—Ä–æ–ø, –∫–∏–Ω–∑–∞, –∑–µ–ª—ë–Ω—ã–π –ª—É–∫, –ª–∏—Å—Ç—å—è —Å–∞–ª–∞—Ç–∞, —Ä—É–∫–∫–æ–ª–∞, —à–ø–∏–Ω–∞—Ç, —â–∞–≤–µ–ª—å, –±–∞–∑–∏–ª–∏–∫, –º–∞–Ω–≥–æ–ª—å–¥, –∫–µ–π–ª"]]}
            />
            <FoodsTable theme={theme} title="–§—Ä—É–∫—Ç—ã –∏ —è–≥–æ–¥—ã"
              rows={[
                ["–ë–æ–ª—å—à–µ –∫–ª–µ—Ç—á–∞—Ç–∫–∏","—è–±–ª–æ–∫–∏ —Å –∫–æ–∂—É—Ä–æ–π, –≥—Ä—É—à–∏ —Å –∫–æ–∂—É—Ä–æ–π, –ø–µ—Ä—Å–∏–∫–∏, –∏–Ω–∂–∏—Ä, —Ö—É—Ä–º–∞, –∞–π–≤–∞, –∫–∏–≤–∏"],
                ["–°—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ","–∞–ø–µ–ª—å—Å–∏–Ω, –º–∞–Ω–¥–∞—Ä–∏–Ω, –≥—Ä–µ–π–ø—Ñ—Ä—É—Ç, –±–∞–Ω–∞–Ω, –Ω–µ–∫—Ç–∞—Ä–∏–Ω, –ø–µ—Ä—Å–∏–∫, —Å–ª–∏–≤–∞, –∞–±—Ä–∏–∫–æ—Å, –≥—Ä–∞–Ω–∞—Ç"],
                ["–ú–µ–Ω—å—à–µ –∫–ª–µ—Ç—á–∞—Ç–∫–∏","–∞–Ω–∞–Ω–∞—Å, –∞—Ä–±—É–∑, –¥—ã–Ω—è, –º–∞–Ω–≥–æ, –ø–∞–ø–∞–π—è"],
                ["–Ø–≥–æ–¥—ã","–º–∞–ª–∏–Ω–∞, —á–µ—Ä–Ω–∏–∫–∞, –∫–ª—é–∫–≤–∞, –µ–∂–µ–≤–∏–∫–∞, –∫–ª—É–±–Ω–∏–∫–∞, –≥–æ–ª—É–±–∏–∫–∞, —Å–º–æ—Ä–æ–¥–∏–Ω–∞"]
              ]}
            />
            <FoodsTable theme={theme} title="–ë–æ–±–æ–≤—ã–µ –∏ —Ü–µ–ª—å–Ω–æ–∑–µ—Ä–Ω–æ–≤—ã–µ (–∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –∫–ª–µ—Ç—á–∞—Ç–∫–∏)"
              rows={[
                ["–ë–æ–±–æ–≤—ã–µ","—á–µ—á–µ–≤–∏—Ü–∞, –Ω—É—Ç, —Ñ–∞—Å–æ–ª—å"],
                ["–¶–µ–ª—å–Ω–æ–∑–µ—Ä–Ω–æ–≤—ã–µ","–æ–≤—Å—è–Ω–∫–∞, –≥—Ä–µ—á–∫–∞, –∫–∏–Ω–æ–∞, –ø—à–µ–Ω–æ, –±—É—Ä—ã–π —Ä–∏—Å, –æ—Ç—Ä—É–±–∏, —Ü–µ–ª—å–Ω–æ–∑–µ—Ä–Ω–æ–≤—ã–µ —Ö–ª–µ–±—Ü—ã, —Å–µ–º–µ–Ω–∞ –ª—å–Ω–∞ –∏ —á–∏–∞, –ø—Å–∏–ª–ª–∏—É–º"]
              ]}
            />
          </div>
          <div id="fats">
            <FoodsTable theme={theme} title="ü´í –ü–û–õ–ï–ó–ù–´–ï –ñ–ò–†–´"
              rows={[
                ["–†—ã–±–∞","–ª–æ—Å–æ—Å—å, —Ñ–æ—Ä–µ–ª—å, —Å–∫—É–º–±—Ä–∏—è, —Å–∞—Ä–¥–∏–Ω—ã"],
                ["–ú–∞—Å–ª–∞","–æ–ª–∏–≤–∫–æ–≤–æ–µ, –ª—å–Ω—è–Ω–æ–µ, –∫–æ–∫–æ—Å–æ–≤–æ–µ, –∫—É–Ω–∂—É—Ç–Ω–æ–µ, —Ç—ã–∫–≤–µ–Ω–Ω–æ–µ, –∏–∑ –≤–∏–Ω–æ–≥—Ä–∞–¥–Ω–æ–π –∫–æ—Å—Ç–æ—á–∫–∏, –∞–≤–æ–∫–∞–¥–æ –∏ –¥—Ä—É–≥–∏–µ —Å—ã—Ä–æ–¥–∞–≤–ª–µ–Ω–Ω—ã–µ"],
                ["–û—Ä–µ—Ö–∏","–≥—Ä–µ—Ü–∫–∏–µ, –º–∏–Ω–¥–∞–ª—å, –∫–µ—à—å—é"],
                ["–°–µ–º–µ–Ω–∞","–ª—ë–Ω, –∫—É–Ω–∂—É—Ç, —á–∏–∞"],
                ["–î—Ä—É–≥–æ–µ","–º–∞—Å–ª–æ –ì–•–ò, –∞–≤–æ–∫–∞–¥–æ"]
              ]}
            />
          </div>
        </div>
      </div>);
    }

    function CheckinCard(props){
      var theme=props.theme, i=props.i, step=props.step, state=props.state, setState=props.setState, next=props.next, back=props.back, progress=props.progress, handleSubmit=props.handleSubmit;
      return (<div style={{background:theme.card,borderRadius:16,padding:16,border:"1px solid "+theme.border}}>
        <Progress value={progress} accent={theme.accent} />
        {step==="carbs" && (<Section title="–¢—ã –µ–ª–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö —É–≥–ª–µ–≤–æ–¥–æ–≤ –∏ –±–µ–ª–∫–∞?" subtitle="–ó–∞ –¥–µ–Ω—å –≤ —Å—É–º–º–µ ‚Äî –æ—Ä–∏–µ–Ω—Ç–∏—Ä—É–π—Å—è –Ω–∞ —á—É–≤—Å—Ç–≤–æ —Å—ã—Ç–æ—Å—Ç–∏ –∏ —ç–Ω–µ—Ä–≥–∏—é">
          <Row>
            <ChoiceBtn active={state.carbs_ok===true} onClick={function(){setState(Object.assign({},state,{carbs_ok:true}));}}>–î–∞ ‚úÖ</ChoiceBtn>
            <ChoiceBtn active={state.carbs_ok===false} onClick={function(){setState(Object.assign({},state,{carbs_ok:false}));}}>–ù–µ–¥–æ–±–æ—Ä ‚õî</ChoiceBtn>
          </Row>
        </Section>)}
        {step==="water" && (<Section title="–ü–∏–ª–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–æ–¥—ã —Å–µ–≥–æ–¥–Ω—è?" subtitle="–û—Ä–∏–µ–Ω—Ç–∏—Ä: ~30 –º–ª/–∫–≥ –º–∞—Å—Å—ã —Ç–µ–ª–∞ –≤ —Å—É—Ç–∫–∏ (–¥–æ 4 –ª), –±–æ–ª—å—à–µ –≤ –∂–∞—Ä—É/–ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏">
          <Row>
            <ChoiceBtn active={state.water_ok===true} onClick={function(){setState(Object.assign({},state,{water_ok:true}));}}>–î–∞ üíß</ChoiceBtn>
            <ChoiceBtn active={state.water_ok===false} onClick={function(){setState(Object.assign({},state,{water_ok:false}));}}>–ù–µ–¥–æ–±–æ—Ä üíß</ChoiceBtn>
          </Row>
        </Section>)}
        {step==="mood" && (<Section title="–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ" subtitle="–ö–∞–∫ —Ç—ã —Å–µ–π—á–∞—Å –≤ —Ü–µ–ª–æ–º?">
          <Row>
            <ChoiceBtn active={state.mood==="positive"} onClick={function(){setState(Object.assign({},state,{mood:"positive"}));}}>üôÇ –•–æ—Ä–æ—à–µ–µ</ChoiceBtn>
            <ChoiceBtn active={state.mood==="neutral"} onClick={function(){setState(Object.assign({},state,{mood:"neutral"}));}}>üòê –ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ–µ</ChoiceBtn>
            <ChoiceBtn active={state.mood==="negative"} onClick={function(){setState(Object.assign({},state,{mood:"negative"}));}}>‚òÅÔ∏è –°–ª–æ–∂–Ω–æ–µ</ChoiceBtn>
          </Row>
        </Section>)}
        {step==="urge" && (<Section title="–¢—è–≥–∞ –∫ —Å–ª–∞–¥–∫–æ–º—É/ –º—É—á–Ω–æ–º—É/ —Ñ–∞—Å—Ç—Ñ—É–¥—É (0‚Äì3)" subtitle="0 ‚Äî –Ω–µ—Ç —Ç—è–≥–∏, 3 ‚Äî –æ—á–µ–Ω—å —Å–∏–ª—å–Ω–∞—è">
          <Row>
            {[0,1,2,3].map(function(v){return (<ChoiceBtn key={v} active={state.urge===v} onClick={function(){setState(Object.assign({},state,{urge:v}));}}>{v}</ChoiceBtn>);})}
          </Row>
        </Section>)}
        {step==="binge" && (<Section title="–≠–ø–∏–∑–æ–¥ –ø–µ—Ä–µ–µ–¥–∞–Ω–∏—è?" subtitle="–ï—Å–ª–∏ –¥–∞ ‚Äî –¥–≤–∏–≥–∞–µ–º—Å—è –º—è–≥–∫–æ, –±–µ–∑ –Ω–∞–∫–∞–∑–∞–Ω–∏–π">
          <Row>
            <ChoiceBtn active={state.binge===true} onClick={function(){setState(Object.assign({},state,{binge:true}));}}>–ë—ã–ª</ChoiceBtn>
            <ChoiceBtn active={state.binge===false} onClick={function(){setState(Object.assign({},state,{binge:false,trigger:null}));}}>–ù–µ –±—ã–ª–æ</ChoiceBtn>
          </Row>
          {state.binge===true && (<div style={{marginTop:10}}>
            <div style={{fontWeight:600,marginBottom:6}}>–ß—Ç–æ –ø–æ—Å–ª—É–∂–∏–ª–æ —Ç—Ä–∏–≥–≥–µ—Ä–æ–º? –ß—Ç–æ –ø—Ä–µ–¥—à–µ—Å—Ç–≤–æ–≤–∞–ª–æ —Å—Ä—ã–≤—É?</div>
            <div style={{fontSize:13,color:theme.subtext,marginBottom:8}}>–ü–æ–¥—Å–∫–∞–∑–∫–∞: –æ—Ç–º–µ—á–∞–π –ø—Ä–∏—á–∏–Ω—ã —á–∞—â–µ ‚Äî —ç—Ç–æ –ø–æ–º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–µ–¥—É–≥–∞–¥—ã–≤–∞—Ç—å —Å—Ä—ã–≤—ã.</div>
            <Row>
              {["—Å—Ç—Ä–µ—Å—Å","—É—Å—Ç–∞–ª–æ—Å—Ç—å","–≥–∞–¥–∂–µ—Ç","–ø—Ä–∏–≤—ã—á–∫–∞","—Å–∫—É–∫–∞","–≤–µ—á–µ—Ä–Ω–µ–µ –≤—Ä–µ–º—è","–¥—Ä—É–≥–æ–µ"].map(function(v){
                return (<ChoiceBtn key={v} active={state.trigger===v} onClick={function(){setState(Object.assign({},state,{trigger:v}));}}>{v}</ChoiceBtn>);
              })}
            </Row>
          </div>)}
          <div style={{marginTop:8,fontSize:13,color:theme.subtext}}>–í—Å–µ –≤–æ–ø—Ä–æ—Å—ã –ø—Ä–æ–π–¥–µ–Ω—ã. –ù–∞–∂–º–∏—Ç–µ ¬´–ì–æ—Ç–æ–≤–æ¬ª, —á—Ç–æ–±—ã –∑–∞–≤–µ—Ä—à–∏—Ç—å —á–µ–∫-–∏–Ω.</div>
        </Section>)}
        <div style={{display:"flex",gap:8,marginTop:8}}>
          <button onClick={back} disabled={i===0} style={btnOutline(theme)}>–ù–∞–∑–∞–¥</button>
          <button onClick={i===(steps.length-1)?handleSubmit:next} style={btnPrimary(theme)}>{i===(steps.length-1)?'–ì–æ—Ç–æ–≤–æ':'–î–∞–ª—å—à–µ'}</button>
        </div>
        <div style={{fontSize:12,color:theme.subtext,marginTop:8}}>–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–Ω–∏–º–∞–µ—Ç ~60 —Å–µ–∫—É–Ω–¥. –î–∞–Ω–Ω—ã–µ ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è –ª–∏—á–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏.</div>
      </div>);
    }

    function App(){
      const tg = useTelegram();
      const theme = useTheme(tg);
      const [screen,setScreen] = useState("checkin"); // 'checkin' | 'protocol' | 'done' | 'foods'
      const [i,setI] = useState(0);
      const [state,setState] = useState({carbs_ok:null,water_ok:null,mood:null,urge:null,binge:null,trigger:null});
      const [sent,setSent] = useState(null);

      useEffect(function(){
        if (typeof window==="undefined") return;
        var loc = (window.location || {});
        var qs = (typeof loc.search === 'string' && loc.search) || (typeof loc.query === 'string' && loc.query) || "";
        var q = new URLSearchParams(qs);
        if(((q.get("screen")||"").toLowerCase())==="protocol") setScreen("protocol");
      },[]);
      useEffect(function(){
        if(!tg) return;
        if(tg.ready) tg.ready();
        if(tg.expand) tg.expand();
        if(tg.MainButton && tg.MainButton.setParams) tg.MainButton.setParams({text: screen==="checkin" ? "–û—Ç–ø—Ä–∞–≤–∏—Ç—å" : "–ó–∞–∫—Ä—ã—Ç—å"});
        if(tg.MainButton && tg.MainButton.show) tg.MainButton.show();
        var onMain = function(){ if(screen==="checkin") handleSubmit(); else if(tg.close) tg.close(); };
        if(tg.onEvent) tg.onEvent("mainButtonClicked", onMain);
        return function(){ if(tg.offEvent) tg.offEvent("mainButtonClicked", onMain); };
      },[tg,screen,state]);

      var step = steps[i];
      var progress = Math.round((i/steps.length)*100);

      function next(){ setI(function(p){return Math.min(p+1,steps.length-1);}); var hf=get(tg,["HapticFeedback","impactOccurred"],null); if(hf) hf("light"); }
      function back(){ setI(function(p){return Math.max(p-1,0);}); }

      function handleSubmit(){
        if(i < steps.length-1) return;
        var userId = get(tg,["initDataUnsafe","user","id"],null);
        var payload = { type:"checkin", ts:Math.floor(Date.now()/1000), user_id:userId,
          carbs_ok:state.carbs_ok, water_ok:state.water_ok, mood:state.mood, urge:state.urge, binge:state.binge, trigger:state.trigger };
        var json = JSON.stringify(payload);
        var send = get(tg,["sendData"],null);
        if(send){ send(json); setSent(json); var note=get(tg,["HapticFeedback","notificationOccurred"],null); if(note) note("success"); }
        else { setSent(json); try{console.info("Check-in JSON", json);}catch(_){} }
        setScreen("done");
        try{ if(typeof window!=="undefined" && window.scrollTo) window.scrollTo({top:0,behavior:"smooth"});}catch(_){}
      }

      function resetCheckin(){ setState({carbs_ok:null,water_ok:null,mood:null,urge:null,binge:null,trigger:null}); setI(0); setSent(null); setScreen("checkin"); }

      useEffect(function(){
        try{
          var t=[]; var a1=pickPrimaryAdvice({binge:true,urge:0,carbs_ok:true}); t.push(["binge priority", !!a1&&a1.title.indexOf("—ç–ø–∏–∑–æ–¥")!==-1]);
          var a2=pickPrimaryAdvice({binge:false,urge:2,carbs_ok:true}); t.push(["urge‚â•2 second", !!a2&&a2.title.indexOf("–¢—è–≥–∞")!==-1]);
          var a3=pickPrimaryAdvice({binge:false,urge:0,carbs_ok:false}); t.push(["carbs deficit third", !!a3&&a3.title.indexOf("–ù–µ–¥–æ–±–æ—Ä")!==-1]);
          var a4=pickPrimaryAdvice({binge:false,urge:0,carbs_ok:true,water_ok:false}); t.push(["water lowest priority", !!a4&&a4.title.indexOf("–ú–∞–ª–æ –≤–æ–¥—ã")!==-1]);
          if(typeof console!=="undefined") console.log("[self-checks]", t);
        }catch(_){}
      },[]);

      return (<div style={{background:theme.bg,color:theme.text,minHeight:"100vh"}}>
        <div style={{maxWidth:560,margin:"0 auto",padding:16}}>
          <Header theme={theme} onOpenProtocol={function(){setScreen("protocol");}} onOpenFoods={function(){setScreen("foods");}} onNewCheckin={resetCheckin} />
          {screen==="protocol" ? (<ProtocolCard theme={theme} />)
           : screen==="foods" ? (<FoodsCard theme={theme} />)
           : screen==="done" ? (<DoneCard theme={theme} state={state} />)
           : (<CheckinCard theme={theme} i={i} step={step} state={state} setState={setState} next={next} back={back} progress={progress} handleSubmit={handleSubmit} />)}
          {sent && (<pre style={{marginTop:16,padding:12,background:theme.card,borderRadius:12,whiteSpace:"pre-wrap",wordBreak:"break-word",border:"1px solid "+theme.border}}>{sent}</pre>)}
        </div>
      </div>);
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>
